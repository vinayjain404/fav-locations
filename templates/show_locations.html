<html>                                                                  
	<head>                                                                  
		<script type="text/javascript" src="../static/jquery-1.8.2.min.js"></script>          
		<script type="text/javascript">                                         
			$(document).ready(function() {
				$.ajax({
				  url: '/location/show/all/',
				  success: function(data) {
					createLocationsView(data)
				  }
				});
			})
			
			function createLocationsView(data) {
				for (var i in data.locations){
					cur_location = data.locations[i];
					id = cur_location.location_id 
					$row = $("<div id=location_" + id + "><tr>");
					$row.append("<td id=name>" + cur_location.name +"</td>");
					$row.append("<td id=address>" + cur_location.address+"</td>");
					$row.append("<td id=view> <input type=button value=View /></td>");
					$row.append("<td id=delete> <input type=button value=Delete /></td>");
					$row.append("<td id=edit> <input type=button value=edit /></td>");
					$row.append("</tr></div>");
					$(".locations").append($row);
					registerHandlers(id, cur_location);
				}
			}

			function registerHandlers(id, cur_location) {
				$("#location_" + id + " #view").bind('click', function(event) {
					geoCode = {};
					geoCode.lat = cur_location.lat;
					geoCode.long = cur_location.long;
					viewLocation(geoCode);	
				});
				$("#location_" + id + " #delete").click(function(event) {
					deleteLocation(id);
				});
				$("#location_" + id + " #edit").click(function(event) {
					createLocation(id);
				});
			}

			function deleteLocation(id) {
				$('.detail_panel').empty();
				$.ajax({
				  url: '/location/remove/' + id + '/',
				  success: function(data) {
					$('#location_' + id).remove();
				  }
				});
			}

			function createLocation(id) {
				$('.detail_panel').empty();
				operation = id != undefined ? 'update' : 'create';
				$addressText = $("<input type=text />");
				$addressText.attr('value', $('#location_'+id+' #address').text());
				$nameText = $("<input type=text />");
				$nameText.attr('value', $('#location_'+id+' #name').text());
				$createButton = $("<input type=button />");
				$createButton.attr('value', operation);
				$(".detail_panel").append($addressText);	
				$(".detail_panel").append($nameText);
				$(".detail_panel").append($createButton);

				$createButton.click(function() {
					// validate the name and address
					if ($nameText.val().length == 0  || $addressText.val().length == 0) {
						alert("Please fill in missing fields name and address");
						return;
					}
					
					locationData = {}
					locationData.user_id = 'vinayjain404'; 
					locationData.lat = 100; //geocode.lat;
					locationData.long = 100;//geocode.long;
					locationData.address = $addressText.val();
					locationData.name = $nameText.val();
					locationData.id = id;

					// fetch geo code and validate address provided
					$.ajax({
						url: "/location/" + operation +"/",
						data: locationData,
						type: 'post',
						success: function(data) {
						      window.location.replace("/show_all_locations");
						}
					});
				});
			}

			function viewLocation(id) {
				$('.detail_panel').empty();
			}
		</script>                                                               
	</head>                                                                 
	<body>                                                                  
		<div class="list_panel">
			<table class="locations">
			</table>
			<input type=button value="Add a location" onclick=createLocation() />
		</div>
		<div class="detail_panel">
		</div>
	</body>                                                                 
</html>
